<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="SmartWallet AI">
<meta name="theme-color" content="#000000">
<meta name="mobile-web-app-capable" content="yes">
<title>SmartWallet AI</title>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#000;--card:#1C1C1E;--card2:#2C2C2E;--card3:#3A3A3C;
--text:#FFF;--text2:#8E8E93;--text3:#636366;
--green:#32D74B;--red:#FF453A;--blue:#0A84FF;--orange:#FF9F0A;
--yellow:#FFD60A;--purple:#BF5AF2;--pink:#FF375F;--teal:#30D5C8;
--r:20px;
--sat:env(safe-area-inset-top,20px);
--sab:env(safe-area-inset-bottom,0px)
}
html,body{
font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','SF Pro Text','Helvetica Neue',sans-serif;
background:var(--bg);color:var(--text);
min-height:100vh;min-height:100dvh;
overflow-x:hidden;-webkit-font-smoothing:antialiased;
-webkit-tap-highlight-color:transparent;-webkit-text-size-adjust:100%
}
body{padding-top:var(--sat);padding-bottom:calc(72px + var(--sab))}
::-webkit-scrollbar{display:none}

/* Header */
.hdr{position:sticky;top:0;z-index:100;padding:12px 20px 10px;
background:rgba(0,0,0,.82);-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter:saturate(180%) blur(20px);
border-bottom:.5px solid rgba(255,255,255,.08)}
.hdr-top{display:flex;justify-content:space-between;align-items:center}
.hdr h1{font-size:28px;font-weight:700;letter-spacing:-.5px}
.hdr-sub{font-size:13px;color:var(--text2);margin-top:2px}

/* User chip */
.usr-chip{display:flex;align-items:center;gap:8px;cursor:pointer}
.usr-ava{width:32px;height:32px;border-radius:50%;border:2px solid var(--blue);object-fit:cover}
.usr-ava-placeholder{width:32px;height:32px;border-radius:50%;background:var(--card2);
display:flex;align-items:center;justify-content:center;font-size:14px}
.db-badge{display:flex;align-items:center;gap:5px;padding:4px 8px;border-radius:10px;font-size:10px;font-weight:600;border:none}
.db-badge.live{background:rgba(50,215,75,.12);color:var(--green)}
.db-badge.off{background:var(--card2);color:var(--text2)}
.db-dot{width:6px;height:6px;border-radius:50%;background:currentColor}
.db-badge.live .db-dot{animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

/* Login Screen */
.login-screen{
position:fixed;inset:0;z-index:600;background:var(--bg);
display:flex;flex-direction:column;align-items:center;justify-content:center;
padding:40px;text-align:center;gap:20px
}
.login-screen.hide{display:none}
.login-logo{font-size:64px;margin-bottom:8px}
.login-title{font-size:32px;font-weight:700;letter-spacing:-.5px}
.login-sub{font-size:15px;color:var(--text2);line-height:1.5;max-width:300px}
.login-form{width:100%;max-width:320px;display:flex;flex-direction:column;gap:12px;margin-top:8px}
.login-fi{text-align:center}
.login-main-btn{margin-top:4px}
.login-switch{background:none;border:none;color:var(--text2);font-size:14px;
font-family:inherit;cursor:pointer;padding:8px;transition:color .2s}
.login-switch strong{color:var(--blue)}
.login-switch:active{color:var(--text)}
.login-err{font-size:13px;color:var(--red);text-align:center;min-height:18px;line-height:1.4}

/* Pages */
.pg{display:none;padding:16px 20px 30px;animation:fadeUp .3s ease}
.pg.on{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* Cards */
.c{background:var(--card);border-radius:var(--r);padding:20px;margin-bottom:14px;transition:transform .15s,opacity .15s}
.c:active{transform:scale(.98);opacity:.9}
.c-t{font-size:13px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px}

/* Balance */
.bal-c{background:linear-gradient(135deg,#1C1C1E,#2C2C2E);border:1px solid rgba(255,255,255,.06);position:relative;overflow:hidden}
.bal-c::after{content:'';position:absolute;top:-50%;right:-50%;width:100%;height:100%;
background:radial-gradient(circle,rgba(50,215,75,.06),transparent 70%);pointer-events:none}
.bal-n{font-size:44px;font-weight:700;letter-spacing:-1.5px;margin:4px 0}
.bal-n.pos{color:var(--green)}.bal-n.neg{color:var(--red)}
.bal-l{font-size:14px;color:var(--text2)}

/* Stats */
.st-row{display:flex;gap:10px;margin-bottom:14px}
.st-card{flex:1;background:var(--card);border-radius:var(--r);padding:14px;text-align:center}
.st-val{font-size:22px;font-weight:700;margin-top:5px}
.st-lbl{font-size:11px;color:var(--text2);letter-spacing:.3px}

/* Progress */
.pr-w{margin-bottom:14px}
.pr-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px}
.pr-n{font-size:14px;font-weight:500}
.pr-v{font-size:13px;color:var(--text2)}
.pr-bar{height:7px;background:var(--card2);border-radius:4px;overflow:hidden}
.pr-fill{height:100%;border-radius:4px;transition:width .6s cubic-bezier(.4,0,.2,1)}

/* Tip */
.tip{background:linear-gradient(135deg,rgba(10,132,255,.12),rgba(191,90,242,.08));
border:1px solid rgba(10,132,255,.2);border-radius:var(--r);padding:18px;margin-bottom:14px}
.tip-tag{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.8px;margin-bottom:6px}
.tip-ico{font-size:26px;margin-bottom:6px}
.tip-txt{font-size:14px;line-height:1.5;color:rgba(255,255,255,.9)}

/* FAB */
.fab{position:fixed;bottom:calc(82px + var(--sab));right:20px;z-index:90;
width:56px;height:56px;border-radius:28px;background:var(--blue);
border:none;color:#fff;font-size:28px;font-weight:300;
display:flex;align-items:center;justify-content:center;
box-shadow:0 4px 20px rgba(10,132,255,.4);transition:transform .15s;cursor:pointer}
.fab:active{transform:scale(.88)}

/* Nav */
.nav{position:fixed;bottom:0;left:0;right:0;z-index:100;
background:rgba(28,28,30,.82);-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter:saturate(180%) blur(20px);
border-top:.5px solid rgba(255,255,255,.08);display:flex;justify-content:space-around;align-items:flex-start;
padding:8px 0 calc(8px + var(--sab));height:calc(72px + var(--sab))}
.nav-i{display:flex;flex-direction:column;align-items:center;gap:3px;
background:none;border:none;color:var(--text2);font-size:10px;font-weight:500;cursor:pointer;padding:4px 14px;transition:color .2s}
.nav-i.on{color:var(--blue)}
.nav-ic{font-size:22px;height:24px;display:flex;align-items:center}

/* Modal */
.mo{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.55);
-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);display:none;align-items:flex-end;justify-content:center}
.mo.open{display:flex}
.mo-s{background:var(--card);border-radius:20px 20px 0 0;width:100%;max-width:500px;max-height:85vh;overflow-y:auto;
padding:20px 20px calc(20px + var(--sab));transform:translateY(100%);transition:transform .35s cubic-bezier(.32,.72,0,1)}
.mo.open .mo-s{transform:none}
.mo-h{width:36px;height:5px;background:rgba(255,255,255,.18);border-radius:3px;margin:0 auto 18px}
.mo-t{font-size:20px;font-weight:700;margin-bottom:18px;text-align:center}

/* Form */
.fg{margin-bottom:16px}
.fl{display:block;font-size:13px;color:var(--text2);margin-bottom:6px;font-weight:500}
.fi{width:100%;padding:14px 16px;background:var(--card2);border:1px solid rgba(255,255,255,.08);
border-radius:12px;color:var(--text);font-size:16px;outline:none;font-family:inherit;
transition:border-color .2s;-webkit-appearance:none}
.fi:focus{border-color:var(--blue)}
.fi::placeholder{color:rgba(255,255,255,.22)}

/* Cat */
.cg{display:flex;flex-wrap:wrap;gap:8px}
.ct{padding:8px 14px;border-radius:20px;font-size:13px;font-weight:500;
background:var(--card2);border:1.5px solid rgba(255,255,255,.06);color:var(--text2);
cursor:pointer;transition:all .2s;user-select:none;-webkit-user-select:none}
.ct.sel{background:rgba(10,132,255,.2);border-color:var(--blue);color:var(--blue)}

/* Btns */
.btn{width:100%;padding:16px;border:none;border-radius:14px;font-size:16px;
font-weight:600;font-family:inherit;cursor:pointer;transition:transform .12s,opacity .12s}
.btn:active{transform:scale(.97);opacity:.85}
.btn-b{background:var(--blue);color:#fff}
.btn-g{background:var(--green);color:#fff}
.btn-r{background:var(--red);color:#fff}
.btn-s{background:var(--card2);color:var(--text)}

/* TX */
.tx{display:flex;align-items:center;gap:14px;padding:14px 0;border-bottom:.5px solid rgba(255,255,255,.06);transition:opacity .3s}
.tx:last-child{border-bottom:none}
.tx-ic{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.tx-d{flex:1;min-width:0}
.tx-n{font-size:15px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tx-m{font-size:12px;color:var(--text2);margin-top:2px}
.tx-a{font-size:16px;font-weight:600;color:var(--red);flex-shrink:0}
.tx-x{background:none;border:none;color:var(--red);font-size:18px;padding:8px;cursor:pointer;opacity:.55;transition:opacity .2s;flex-shrink:0}
.tx-x:active{opacity:1}

/* Settings */
.ss{margin-bottom:24px}
.ss-t{font-size:18px;font-weight:700;margin-bottom:14px}
.sr{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:var(--card);border-radius:14px;margin-bottom:8px}
.sr-l{font-size:15px;font-weight:500}
.sr-i{width:100px;padding:8px 12px;background:var(--card2);border:1px solid rgba(255,255,255,.08);
border-radius:10px;color:var(--text);font-size:15px;text-align:right;font-family:inherit;outline:none;-webkit-appearance:none}
.sr-i:focus{border-color:var(--blue)}
.sr-s{font-size:14px;color:var(--text2);margin-left:4px}

/* Misc */
.empty{text-align:center;padding:40px 20px;color:var(--text2)}
.empty-i{font-size:48px;margin-bottom:12px}
.empty-t{font-size:15px;line-height:1.5}
.dsep{font-size:13px;font-weight:600;color:var(--text2);padding:12px 0 6px;text-transform:uppercase;letter-spacing:.5px}
.ver{text-align:center;color:var(--text3);font-size:12px;margin-top:24px;padding-bottom:20px}

/* Logout */
.logout-row{display:flex;align-items:center;gap:14px;padding:16px;background:var(--card);border-radius:14px;margin-bottom:16px}
.logout-ava{width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid var(--blue)}
.logout-info{flex:1}
.logout-name{font-size:15px;font-weight:600}
.logout-email{font-size:12px;color:var(--text2);margin-top:2px}
.logout-btn{background:none;border:1px solid rgba(255,69,58,.3);color:var(--red);
padding:8px 14px;border-radius:10px;font-size:13px;font-weight:600;font-family:inherit;cursor:pointer}

.rst{margin-top:20px;padding:14px;background:rgba(255,69,58,.08);border:1px solid rgba(255,69,58,.15);
border-radius:14px;color:var(--red);font-size:15px;font-weight:600;width:100%;cursor:pointer;font-family:inherit}

/* Confirm */
.cfm{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.5);-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);
display:none;align-items:center;justify-content:center;padding:40px}
.cfm.open{display:flex}
.cfm-b{background:var(--card2);border-radius:16px;padding:24px;text-align:center;max-width:300px;width:100%;animation:pop .25s cubic-bezier(.32,.72,0,1)}
@keyframes pop{from{transform:scale(.85);opacity:0}to{transform:scale(1);opacity:1}}
.cfm-m{font-size:15px;margin-bottom:20px;line-height:1.5}
.cfm-r{display:flex;gap:10px}
.cfm-r .btn{flex:1;padding:12px}

/* Toast */
.toast{position:fixed;top:calc(var(--sat) + 60px);left:50%;transform:translateX(-50%) translateY(-20px);
z-index:400;padding:12px 20px;border-radius:14px;font-size:14px;font-weight:600;
opacity:0;transition:all .3s cubic-bezier(.32,.72,0,1);pointer-events:none;max-width:88%;text-align:center;
-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.ok{background:rgba(50,215,75,.18);color:var(--green);border:1px solid rgba(50,215,75,.25)}
.toast.err{background:rgba(255,69,58,.18);color:var(--red);border:1px solid rgba(255,69,58,.25)}
.toast.inf{background:rgba(10,132,255,.18);color:var(--blue);border:1px solid rgba(10,132,255,.25)}

/* Cat colors */
.cc-food{background:rgba(255,159,10,.15);color:var(--orange)}
.cc-super{background:rgba(255,214,10,.15);color:var(--yellow)}
.cc-transport{background:rgba(10,132,255,.15);color:var(--blue)}
.cc-ent{background:rgba(191,90,242,.15);color:var(--purple)}
.cc-shop{background:rgba(255,55,95,.15);color:var(--pink)}
.cc-health{background:rgba(50,215,75,.15);color:var(--green)}
.cc-bills{background:rgba(255,69,58,.15);color:var(--red)}
.cc-other{background:rgba(142,142,147,.15);color:var(--text2)}

/* Loading */
.ld{position:fixed;inset:0;z-index:500;background:var(--bg);
display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;transition:opacity .4s}
.ld.hide{opacity:0;pointer-events:none}
.ld-sp{width:36px;height:36px;border:3px solid var(--card2);border-top-color:var(--blue);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.ld-t{font-size:14px;color:var(--text2)}

/* App container - hidden until login */
.app-wrap{display:none}
.app-wrap.show{display:block}
</style>
</head>
<body>

<!-- â•â•â• Login Screen â•â•â• -->
<div class="login-screen" id="loginScr">
<div class="login-logo">ğŸ’°</div>
<div class="login-title">SmartWallet AI</div>
<div class="login-sub">ÎŸ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒÏ‚ ÏƒÎ¿Ï… Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒÏ‚ Î²Î¿Î·Î¸ÏŒÏ‚. Î¦Ï„Î¹Î¬Î¾Îµ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î³Î¹Î± Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎ¿Ï… ÏƒÏ„Î¿ cloud.</div>
<div class="login-form">
<input type="email" class="fi login-fi" id="authEmail" placeholder="Email" autocomplete="email">
<input type="password" class="fi login-fi" id="authPass" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ (min 6 Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚)" autocomplete="current-password">
<div class="login-err" id="authErr"></div>
<button class="btn btn-b login-main-btn" id="authBtn" onclick="doAuth()">Î£ÏÎ½Î´ÎµÏƒÎ·</button>
<button class="login-switch" id="authSwitch" onclick="toggleAuthMode()">Î”ÎµÎ½ Î­Ï‡ÎµÎ¹Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ; <strong>Î•Î³Î³ÏÎ±Ï†Î®</strong></button>
</div>
</div>

<!-- â•â•â• Loading â•â•â• -->
<div class="ld hide" id="loadScr">
<div class="ld-sp"></div>
<div class="ld-t">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...</div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- â•â•â• Main App (hidden until login) â•â•â• -->
<div class="app-wrap" id="appWrap">

<!-- Header -->
<div class="hdr">
<div class="hdr-top">
<div>
<h1 id="pgTitle">SmartWallet AI</h1>
<div class="hdr-sub" id="pgSub">ÎŸ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒÏ‚ ÏƒÎ¿Ï… Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒÏ‚ Î²Î¿Î·Î¸ÏŒÏ‚</div>
</div>
<div class="usr-chip" onclick="go('pgSet',document.querySelector('[data-pg=pgSet]'))">
<div class="db-badge live" id="dbBadge"><span class="db-dot"></span><span id="dbText">Live</span></div>
<div class="usr-ava-placeholder">ğŸ‘¤</div>
</div>
</div>
</div>

<!-- Dashboard -->
<div class="pg on" id="pgDash">
<div class="bal-c c">
<div class="c-t">Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿</div>
<div class="bal-n pos" id="balNum">0,00â‚¬</div>
<div class="bal-l" id="balLbl">Î±Ï€ÏŒ 0,00â‚¬ ÎµÎ¹ÏƒÏŒÎ´Î·Î¼Î±</div>
</div>
<div class="st-row">
<div class="st-card"><div class="st-lbl">Î•Î²Î´Î¿Î¼Î±Î´Î¹Î±Î¯Î¿</div><div class="st-val" id="wkVal" style="color:var(--blue)">0â‚¬</div></div>
<div class="st-card"><div class="st-lbl">Î—Î¼ÎµÏÎ®ÏƒÎ¹Î¿</div><div class="st-val" id="dyVal" style="color:var(--teal)">0â‚¬</div></div>
<div class="st-card"><div class="st-lbl">Î—Î¼Î­ÏÎµÏ‚</div><div class="st-val" id="dLeft" style="color:var(--orange)">0</div></div>
</div>
<div id="tipBox"></div>
<div class="c"><div class="c-t">ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î•Î¾ÏŒÎ´Ï‰Î½</div><div id="progBars"></div></div>
<div class="c"><div class="c-t">Î ÏÏŒÏƒÏ†Î±Ï„ÎµÏ‚ Î£Ï…Î½Î±Î»Î»Î±Î³Î­Ï‚</div><div id="recTx"></div></div>
</div>

<!-- Transactions -->
<div class="pg" id="pgTx">
<div class="c"><div class="c-t">ÎŒÎ»ÎµÏ‚ Î¿Î¹ Î£Ï…Î½Î±Î»Î»Î±Î³Î­Ï‚</div><div id="allTx"></div></div>
</div>

<!-- Settings -->
<div class="pg" id="pgSet">
<div class="ss">
<div class="ss-t">Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚</div>
<div class="logout-row">
<div class="usr-ava-placeholder" style="width:44px;height:44px;font-size:20px;flex-shrink:0">ğŸ‘¤</div>
<div class="logout-info">
<div class="logout-name" id="setName">â€”</div>
<div class="logout-email" id="setEmail">â€”</div>
</div>
<button class="logout-btn" onclick="doLogout()">Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</button>
</div>
</div>

<div class="ss">
<div class="ss-t">ÎœÎ·Î½Î¹Î±Î¯Î¿ Î•Î¹ÏƒÏŒÎ´Î·Î¼Î±</div>
<div class="sr"><span class="sr-l">Î•Î¹ÏƒÏŒÎ´Î·Î¼Î±</span><div style="display:flex;align-items:center"><input type="number" class="sr-i" id="sInc" inputmode="decimal"><span class="sr-s">â‚¬</span></div></div>
</div>
<div class="ss">
<div class="ss-t">Î£Ï„ÏŒÏ‡Î¿Ï‚ Î‘Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·Ï‚</div>
<div class="sr"><span class="sr-l">Î‘Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·</span><div style="display:flex;align-items:center"><input type="number" class="sr-i" id="sSav" inputmode="decimal"><span class="sr-s">â‚¬</span></div></div>
</div>
<div class="ss">
<div class="ss-t">Î Î¬Î³Î¹Î± ÎˆÎ¾Î¿Î´Î±</div>
<div class="sr"><span class="sr-l">Î•Î½Î¿Î¯ÎºÎ¹Î¿ / Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Î¯</span><div style="display:flex;align-items:center"><input type="number" class="sr-i" id="sRent" inputmode="decimal"><span class="sr-s">â‚¬</span></div></div>
<div class="sr"><span class="sr-l">Î”Î¬Î½ÎµÎ¹Î¿ / Î”ÏŒÏƒÎµÎ¹Ï‚</span><div style="display:flex;align-items:center"><input type="number" class="sr-i" id="sLoan" inputmode="decimal"><span class="sr-s">â‚¬</span></div></div>
<div class="sr"><span class="sr-l">Î“Ï…Î¼Î½Î±ÏƒÏ„Î®ÏÎ¹Î¿</span><div style="display:flex;align-items:center"><input type="number" class="sr-i" id="sGym" inputmode="decimal"><span class="sr-s">â‚¬</span></div></div>
</div>
<div class="ss">
<div class="ss-t">Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯</div>
<div class="sr"><span class="sr-l">Î£Î¿ÏÏ€ÎµÏ ÎœÎ¬ÏÎºÎµÏ„</span><div style="display:flex;align-items:center"><input type="number" class="sr-i" id="sSup" inputmode="decimal"><span class="sr-s">â‚¬</span></div></div>
</div>
<button class="btn btn-b" id="saveBtn" onclick="saveSettings()">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î¡Ï…Î¸Î¼Î¯ÏƒÎµÏ‰Î½</button>
<button class="rst" onclick="confirmReset()">Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ ÎŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½</button>
<div class="ver">SmartWallet AI v4.0 â€” Firebase Auth + Firestore<br>Î¤Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎ¿Ï…, Ï€Î±Î½Ï„Î¿Ï, Ï€Î¬Î½Ï„Î±.</div>
</div>

<!-- FAB -->
<button class="fab" id="fab" onclick="openModal()">+</button>

<!-- Nav -->
<nav class="nav">
<button class="nav-i on" data-pg="pgDash" onclick="go('pgDash',this)"><span class="nav-ic">ğŸ“Š</span>Î‘ÏÏ‡Î¹ÎºÎ®</button>
<button class="nav-i" data-pg="pgTx" onclick="go('pgTx',this)"><span class="nav-ic">ğŸ“‹</span>Î£Ï…Î½Î±Î»Î»Î±Î³Î­Ï‚</button>
<button class="nav-i" data-pg="pgSet" onclick="go('pgSet',this)"><span class="nav-ic">âš™ï¸</span>Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚</button>
</nav>
</div><!-- /app-wrap -->

<!-- Add Modal -->
<div class="mo" id="addMo">
<div class="mo-s">
<div class="mo-h"></div>
<div class="mo-t">ÎÎ­Î± Î£Ï…Î½Î±Î»Î»Î±Î³Î®</div>
<div class="fg"><label class="fl">Î Î¿ÏƒÏŒ (â‚¬)</label><input type="number" class="fi" id="txAmt" placeholder="Ï€.Ï‡. 25.50" inputmode="decimal" step="0.01"></div>
<div class="fg"><label class="fl">Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</label><input type="text" class="fi" id="txDsc" placeholder="Ï€.Ï‡. ÎšÎ±Ï†Î­Ï‚ Î¼Îµ Ï†Î¯Î»Î¿Ï…Ï‚" autocomplete="off"></div>
<div class="fg">
<label class="fl">ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</label>
<div class="cg" id="catG">
<div class="ct" data-c="food" onclick="selCat(this)">ğŸ• Î¦Î±Î³Î·Ï„ÏŒ</div>
<div class="ct" data-c="super" onclick="selCat(this)">ğŸ›’ Î£Î¿ÏÏ€ÎµÏ ÎœÎ¬ÏÎºÎµÏ„</div>
<div class="ct" data-c="transport" onclick="selCat(this)">ğŸš— ÎœÎµÏ„Î±Ï†Î¿ÏÎ¹ÎºÎ¬</div>
<div class="ct" data-c="ent" onclick="selCat(this)">ğŸ¬ Î¨Ï…Ï‡Î±Î³Ï‰Î³Î¯Î±</div>
<div class="ct" data-c="shop" onclick="selCat(this)">ğŸ›ï¸ Î‘Î³Î¿ÏÎ­Ï‚</div>
<div class="ct" data-c="health" onclick="selCat(this)">ğŸ’Š Î¥Î³ÎµÎ¯Î±</div>
<div class="ct" data-c="bills" onclick="selCat(this)">ğŸ“„ Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Î¯</div>
<div class="ct" data-c="other" onclick="selCat(this)">ğŸ“Œ Î†Î»Î»Î¿</div>
</div>
</div>
<button class="btn btn-g" onclick="addTx()">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î•Î¾ÏŒÎ´Î¿Ï…</button>
<button class="btn btn-s" style="margin-top:10px" onclick="closeMo()">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
</div>
</div>

<!-- Confirm -->
<div class="cfm" id="cfmOv">
<div class="cfm-b">
<div class="cfm-m" id="cfmMsg"></div>
<div class="cfm-r">
<button class="btn btn-s" onclick="closeCfm()">ÎŒÏ‡Î¹</button>
<button class="btn btn-r" id="cfmYes">ÎÎ±Î¹</button>
</div>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, doc, addDoc, deleteDoc, setDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyA0O8vfoMvMeyEJltU3QWfxT3_dIJpirLs",
  authDomain: "my-wallet-app-c4fb6.firebaseapp.com",
  projectId: "my-wallet-app-c4fb6",
  storageBucket: "my-wallet-app-c4fb6.firebasestorage.app",
  messagingSenderId: "233595751510",
  appId: "1:233595751510:web:1e3dcfaebeb6c66feb7ff7",
  measurementId: "G-GTDED0H3EX"
};

const fbApp = initializeApp(firebaseConfig);
const auth = getAuth(fbApp);
const db = getFirestore(fbApp);
let isLoginMode = true; // true=login, false=register

// â”€â”€ State â”€â”€
const CATS={food:{label:'Î¦Î±Î³Î·Ï„ÏŒ',icon:'ğŸ•',css:'cc-food'},super:{label:'Î£Î¿ÏÏ€ÎµÏ ÎœÎ¬ÏÎºÎµÏ„',icon:'ğŸ›’',css:'cc-super'},
transport:{label:'ÎœÎµÏ„Î±Ï†Î¿ÏÎ¹ÎºÎ¬',icon:'ğŸš—',css:'cc-transport'},ent:{label:'Î¨Ï…Ï‡Î±Î³Ï‰Î³Î¯Î±',icon:'ğŸ¬',css:'cc-ent'},
shop:{label:'Î‘Î³Î¿ÏÎ­Ï‚',icon:'ğŸ›ï¸',css:'cc-shop'},health:{label:'Î¥Î³ÎµÎ¯Î±',icon:'ğŸ’Š',css:'cc-health'},
bills:{label:'Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Î¯',icon:'ğŸ“„',css:'cc-bills'},other:{label:'Î†Î»Î»Î¿',icon:'ğŸ“Œ',css:'cc-other'}};

const DEF={income:1150,savings:200,rent:200,loan:120,gym:70,supermarket:150};
let settings={...DEF};
let transactions=[];
let selCategory=null;
let cfmCb=null;
let currentUser=null;
let unsubTx=null;
let unsubSet=null;

const $=id=>document.getElementById(id);
const fmt=n=>n.toLocaleString('el-GR',{minimumFractionDigits:2,maximumFractionDigits:2})+'â‚¬';
const esc=s=>{const d=document.createElement('div');d.textContent=s;return d.innerHTML};
const now=()=>new Date();
const dim=()=>new Date(now().getFullYear(),now().getMonth()+1,0).getDate();
const dleft=()=>Math.max(0,dim()-now().getDate());
const wleft=()=>Math.max(1,Math.ceil(dleft()/7));
const dleftN=()=>Math.max(1,dleft()||1);

function mTx(){const n=now(),y=n.getFullYear(),m=n.getMonth();
return transactions.filter(t=>{const d=new Date(t.date);return d.getFullYear()===y&&d.getMonth()===m});}
function cSum(c){return mTx().filter(t=>t.category===c).reduce((s,t)=>s+t.amount,0);}
function tSpent(){return mTx().reduce((s,t)=>s+t.amount,0);}
function fixed(){return settings.rent+settings.loan+settings.gym;}
function safe(){return settings.income-fixed()-settings.savings-tSpent();}

function fDate(d){const dt=new Date(d);
const mo=['Î™Î±Î½','Î¦ÎµÎ²','ÎœÎ±Ï','Î‘Ï€Ï','ÎœÎ±Î','Î™Î¿Ï…Î½','Î™Î¿Ï…Î»','Î‘Ï…Î³','Î£ÎµÏ€','ÎŸÎºÏ„','ÎÎ¿Îµ','Î”ÎµÎº'];
const dy=['ÎšÏ…Ï','Î”ÎµÏ…','Î¤ÏÎ¹','Î¤ÎµÏ„','Î ÎµÎ¼','Î Î±Ï','Î£Î±Î²'];
return `${dy[dt.getDay()]}, ${dt.getDate()} ${mo[dt.getMonth()]}`;}
function fTime(d){const dt=new Date(d);return dt.getHours().toString().padStart(2,'0')+':'+dt.getMinutes().toString().padStart(2,'0');}

// â”€â”€ Toast â”€â”€
let toastT;
function toast(m,t='inf'){const e=$('toast');e.textContent=m;e.className='toast '+t;
clearTimeout(toastT);requestAnimationFrame(()=>{e.classList.add('show');toastT=setTimeout(()=>e.classList.remove('show'),2500);});}

// â”€â”€ Nav â”€â”€
window.go=(p,b)=>{document.querySelectorAll('.pg').forEach(x=>x.classList.remove('on'));
$(p).classList.add('on');document.querySelectorAll('.nav-i').forEach(x=>x.classList.remove('on'));
if(b)b.classList.add('on');
const t={pgDash:['SmartWallet AI','ÎŸ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒÏ‚ ÏƒÎ¿Ï… Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒÏ‚ Î²Î¿Î·Î¸ÏŒÏ‚'],
pgTx:['Î£Ï…Î½Î±Î»Î»Î±Î³Î­Ï‚','Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÎµÎ¾ÏŒÎ´Ï‰Î½'],pgSet:['Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚','Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï']};
const v=t[p]||t.pgDash;$('pgTitle').textContent=v[0];$('pgSub').textContent=v[1];
$('fab').style.display=p==='pgSet'?'none':'flex';};

// â”€â”€ Modal â”€â”€
window.openModal=()=>{$('txAmt').value='';$('txDsc').value='';selCategory=null;
document.querySelectorAll('.ct').forEach(t=>t.classList.remove('sel'));$('addMo').classList.add('open');};
window.closeMo=()=>$('addMo').classList.remove('open');
$('addMo').addEventListener('click',e=>{if(e.target===$('addMo'))window.closeMo();});
window.selCat=el=>{document.querySelectorAll('.ct').forEach(t=>t.classList.remove('sel'));el.classList.add('sel');selCategory=el.dataset.c;};

// â”€â”€ Shake â”€â”€
const shk=document.createElement('style');
shk.textContent='@keyframes shk{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}';
document.head.appendChild(shk);
function shake(id){const e=$(id);e.style.borderColor='var(--red)';e.style.animation='none';
e.offsetHeight;e.style.animation='shk .4s ease';setTimeout(()=>{e.style.borderColor='';e.style.animation=''},500);}

// â”€â”€ Confirm â”€â”€
window.closeCfm=()=>{$('cfmOv').classList.remove('open');cfmCb=null;};
function showCfm(m,cb){$('cfmMsg').textContent=m;cfmCb=cb;$('cfmOv').classList.add('open');}
$('cfmYes').addEventListener('click',()=>{if(cfmCb)cfmCb();window.closeCfm();});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH (Email/Password)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const AUTH_ERRORS = {
  'auth/email-already-in-use':'Î‘Ï…Ï„ÏŒ Ï„Î¿ email Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î®Î´Î·.',
  'auth/weak-password':'ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 6 Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚.',
  'auth/invalid-email':'ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ email.',
  'auth/user-not-found':'Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ email.',
  'auth/wrong-password':'Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚.',
  'auth/invalid-credential':'Î›Î¬Î¸Î¿Ï‚ email Î® ÎºÏ‰Î´Î¹ÎºÏŒÏ‚.',
  'auth/too-many-requests':'Î Î¿Î»Î»Î­Ï‚ Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹ÎµÏ‚. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î±ÏÎ³ÏŒÏ„ÎµÏÎ±.',
  'auth/missing-password':'Î’Î¬Î»Îµ ÎºÏ‰Î´Î¹ÎºÏŒ.',
  'auth/missing-email':'Î’Î¬Î»Îµ email.'
};

window.toggleAuthMode = () => {
  isLoginMode = !isLoginMode;
  $('authBtn').textContent = isLoginMode ? 'Î£ÏÎ½Î´ÎµÏƒÎ·' : 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï';
  $('authSwitch').innerHTML = isLoginMode
    ? 'Î”ÎµÎ½ Î­Ï‡ÎµÎ¹Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ; <strong>Î•Î³Î³ÏÎ±Ï†Î®</strong>'
    : 'ÎˆÏ‡ÎµÎ¹Ï‚ Î®Î´Î· Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ; <strong>Î£ÏÎ½Î´ÎµÏƒÎ·</strong>';
  $('authErr').textContent = '';
};

window.doAuth = async () => {
  const email = $('authEmail').value.trim();
  const pass = $('authPass').value;
  $('authErr').textContent = '';

  if(!email){$('authErr').textContent='Î’Î¬Î»Îµ Ï„Î¿ email ÏƒÎ¿Ï….';shake('authEmail');return;}
  if(!pass){$('authErr').textContent='Î’Î¬Î»Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ ÏƒÎ¿Ï….';shake('authPass');return;}

  $('authBtn').textContent = 'Î ÎµÏÎ¯Î¼ÎµÎ½Îµ...';
  $('authBtn').style.opacity = '0.6';

  try {
    if(isLoginMode) {
      await signInWithEmailAndPassword(auth, email, pass);
    } else {
      await createUserWithEmailAndPassword(auth, email, pass);
    }
  } catch(e) {
    const msg = AUTH_ERRORS[e.code] || 'Î£Ï†Î¬Î»Î¼Î±: ' + e.message;
    $('authErr').textContent = msg;
    $('authBtn').textContent = isLoginMode ? 'Î£ÏÎ½Î´ÎµÏƒÎ·' : 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï';
    $('authBtn').style.opacity = '1';
  }
};

// Enter key to submit
$('authPass').addEventListener('keydown', e => { if(e.key==='Enter') window.doAuth(); });
$('authEmail').addEventListener('keydown', e => { if(e.key==='Enter') $('authPass').focus(); });

window.doLogout = async ()=>{
  showCfm('Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ· Î±Ï€ÏŒ Ï„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ;', async ()=>{
    if(unsubTx) unsubTx();
    if(unsubSet) unsubSet();
    transactions=[];settings={...DEF};
    await signOut(auth);
  });
};

onAuthStateChanged(auth, user => {
  if(user) {
    currentUser = user;
    $('loginScr').classList.add('hide');
    $('appWrap').classList.add('show');
    $('loadScr').classList.remove('hide');
    $('loadScr').style.display='flex';

    // User info
    $('setName').textContent=user.email.split('@')[0];
    $('setEmail').textContent=user.email;

    startListeners(user.uid);
  } else {
    currentUser = null;
    $('loginScr').classList.remove('hide');
    $('appWrap').classList.remove('show');
    $('authBtn').textContent = isLoginMode ? 'Î£ÏÎ½Î´ÎµÏƒÎ·' : 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï';
    $('authBtn').style.opacity = '1';
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIRESTORE (user-scoped)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function userDoc(uid,path){return doc(db,'users',uid,...path.split('/'));}
function userCol(uid,col){return collection(db,'users',uid,col);}

function startListeners(uid) {
  // Transactions
  const tq = query(userCol(uid,'transactions'), orderBy('date','desc'));
  unsubTx = onSnapshot(tq, snap=>{
    transactions = snap.docs.map(d=>({id:d.id,...d.data()}));
    renderAll();
    hideLoading();
  }, err=>{
    console.error('TX err:',err);
    $('dbBadge').className='db-badge off';$('dbText').textContent='Î£Ï†Î¬Î»Î¼Î±';
    hideLoading();
  });

  // Settings
  const sRef = userDoc(uid,'settings/config');
  unsubSet = onSnapshot(sRef, snap=>{
    if(snap.exists()){
      settings={...DEF,...snap.data()};
    } else {
      settings={...DEF};
      setDoc(sRef,DEF).catch(()=>{});
    }
    fillSettings();
    renderAll();
  });
}

function hideLoading(){
  $('dbBadge').className='db-badge live';$('dbText').textContent='Live';
  $('loadScr').classList.add('hide');
  setTimeout(()=>{$('loadScr').style.display='none';},400);
}

// â”€â”€ Add TX â”€â”€
window.addTx = async ()=>{
  if(!currentUser)return;
  const amt=parseFloat($('txAmt').value);
  const dsc=$('txDsc').value.trim();
  if(!amt||amt<=0){shake('txAmt');return;}
  if(!dsc){shake('txDsc');return;}
  if(!selCategory){const g=$('catG');g.style.outline='2px solid var(--red)';g.style.borderRadius='12px';
  setTimeout(()=>g.style.outline='none',800);return;}
  try{
    await addDoc(userCol(currentUser.uid,'transactions'),{
      amount:Math.round(amt*100)/100, description:dsc, category:selCategory,
      date:now().toISOString(), createdAt:now().getTime()
    });
    window.closeMo();toast('Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ!','ok');
  }catch(e){toast('Î£Ï†Î¬Î»Î¼Î±','err');console.error(e);}
};

// â”€â”€ Delete TX â”€â”€
window.delTx=(id)=>{
  showCfm('Î”Î¹Î±Î³ÏÎ±Ï†Î® Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÏƒÏ…Î½Î±Î»Î»Î±Î³Î®Ï‚;',async()=>{
    try{await deleteDoc(doc(db,'users',currentUser.uid,'transactions',id));toast('Î”Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ','ok');}
    catch(e){toast('Î£Ï†Î¬Î»Î¼Î±','err');}
  });
};

// â”€â”€ Save Settings â”€â”€
window.saveSettings = async ()=>{
  if(!currentUser)return;
  const s={
    income:parseFloat($('sInc').value)||0,
    savings:parseFloat($('sSav').value)||0,
    rent:parseFloat($('sRent').value)||0,
    loan:parseFloat($('sLoan').value)||0,
    gym:parseFloat($('sGym').value)||0,
    supermarket:parseFloat($('sSup').value)||0
  };
  try{
    await setDoc(userDoc(currentUser.uid,'settings/config'),s);
    toast('Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½!','ok');
    const b=$('saveBtn');const o=b.textContent;b.textContent='âœ“ Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ!';b.style.background='var(--green)';
    setTimeout(()=>{b.textContent=o;b.style.background='';},1500);
  }catch(e){toast('Î£Ï†Î¬Î»Î¼Î± Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚','err');console.error(e);}
};

// â”€â”€ Reset â”€â”€
window.confirmReset=()=>{
  showCfm('Î”Î¹Î±Î³ÏÎ±Ï†Î® ÎŸÎ›Î©Î Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Ï€ÏŒ Ï„Î¿ cloud;',async()=>{
    try{
      for(const tx of transactions){await deleteDoc(doc(db,'users',currentUser.uid,'transactions',tx.id));}
      await setDoc(userDoc(currentUser.uid,'settings/config'),DEF);
      toast('Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ','ok');
    }catch(e){toast('Î£Ï†Î¬Î»Î¼Î±','err');}
  });
};

function fillSettings(){
  $('sInc').value=settings.income;$('sSav').value=settings.savings;
  $('sRent').value=settings.rent;$('sLoan').value=settings.loan;
  $('sGym').value=settings.gym;$('sSup').value=settings.supermarket;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI TIPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function tips(){
  const t=[];const b=safe();const sp=tSpent();
  const tr=cSum('transport'),su=cSum('super'),fd=cSum('food'),en=cSum('ent'),sh=cSum('shop');

  if(b<50&&sp>0)t.push({icon:'ğŸš¨',tag:'ÎšÏÎ¯ÏƒÎ¹Î¼Î· Î•Î¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·',txt:'ÎšÏÎ¯ÏƒÎ¹Î¼Î¿! Î Î¬Î³Ï‰ÏƒÎµ ÎºÎ¬Î¸Îµ Î¼Î· Î±Î½Î±Î³ÎºÎ±Î¯Î¿ Î­Î¾Î¿Î´Î¿ Î±Î¼Î­ÏƒÏ‰Ï‚!',color:'var(--red)'});
  else if(b<100&&sp>0)t.push({icon:'âš ï¸',tag:'Î ÏÎ¿ÏƒÎ¿Ï‡Î®',txt:'Î§Î±Î¼Î·Î»ÏŒ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿! Î•ÏƒÏ„Î¯Î±ÏƒÎµ Î¼ÏŒÎ½Î¿ ÏƒÏ„Î± Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î±.',color:'var(--orange)'});
  if(tr>80)t.push({icon:'ğŸš—',tag:'ÎœÎµÏ„Î±Ï†Î¿ÏÎ¹ÎºÎ¬',txt:`Î¥ÏˆÎ·Î»Î¬ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¹ÎºÎ¬ (${fmt(tr)}). Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ ÎœÎœÎœ, Î³Î»Î¯Ï„Ï‰ÏƒÎµ ~70â‚¬/Î¼Î®Î½Î±.`,color:'var(--blue)'});
  if(su>settings.supermarket)t.push({icon:'ğŸ›’',tag:'Î£Î¿ÏÏ€ÎµÏ ÎœÎ¬ÏÎºÎµÏ„',txt:`ÎÎµÏ€Î­ÏÎ±ÏƒÎµÏ‚ Ï„Î¿Î½ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ (${fmt(su)}/${fmt(settings.supermarket)}). Î¨Î¬Î¾Îµ Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ­Ï‚!`,color:'var(--yellow)'});
  if(fd>100)t.push({icon:'ğŸ•',tag:'Î¦Î±Î³Î·Ï„ÏŒ',txt:`Î Î¿Î»Î»Î¬ ÏƒÎµ Ï†Î±Î³Î·Ï„ÏŒ Î­Î¾Ï‰ (${fmt(fd)}). ÎœÎ±Î³ÎµÎ¯ÏÎµÏˆÎµ ÏƒÏ€Î¯Ï„Î¹!`,color:'var(--orange)'});
  if(en>60)t.push({icon:'ğŸ¬',tag:'Î¨Ï…Ï‡Î±Î³Ï‰Î³Î¯Î±',txt:`ÎˆÎ¾Î¿Î´Î± ÏˆÏ…Ï‡Î±Î³Ï‰Î³Î¯Î±Ï‚ ${fmt(en)}. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î´Ï‰ÏÎµÎ¬Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚!`,color:'var(--purple)'});
  if(sh>80)t.push({icon:'ğŸ›ï¸',tag:'Î‘Î³Î¿ÏÎ­Ï‚',txt:`Î Î¿Î»Î»Î¬ ÏƒÎµ Î±Î³Î¿ÏÎ­Ï‚ (${fmt(sh)}). Î§ÏÎµÎ¹Î¬Î¶ÎµÏƒÎ±Î¹ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ¬ Î±Ï…Ï„Î¬;`,color:'var(--pink)'});
  if(b>=settings.savings&&sp>0)t.push({icon:'âœ…',tag:'Î‘Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·',txt:`ÎœÏ€ÏÎ¬Î²Î¿! On track Î³Î¹Î± ${fmt(settings.savings)} Î±Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·!`,color:'var(--green)'});
  if(sp===0)t.push({icon:'ğŸ’¡',tag:'ÎÎµÎºÎ¯Î½Î±',txt:'Î ÏÏŒÏƒÎ¸ÎµÏƒÎµ Ï„Î± Ï€ÏÏÏ„Î± ÏƒÎ¿Ï… Î­Î¾Î¿Î´Î± Î³Î¹Î± ÏƒÏ…Î¼Î²Î¿Ï…Î»Î­Ï‚!',color:'var(--blue)'});

  const d=now().getDate(),dm=dim(),spendable=settings.income-fixed()-settings.savings;
  if(d<=dm/2&&sp>spendable*.6&&sp>0)t.push({icon:'ğŸ“ˆ',tag:'Î¡Ï…Î¸Î¼ÏŒÏ‚',txt:'Î Î¬Î½Ï‰ Î±Ï€ÏŒ 60% ÏƒÏ„Î¿ Î¼Î¹ÏƒÏŒ Î¼Î®Î½Î±. Î ÏÏŒÏƒÎµÎ¾Îµ!',color:'var(--orange)'});
  return t;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAll(){renderDash();renderTxL('recTx',5);renderTxL('allTx',0);}

function renderDash(){
  const b=safe();$('balNum').textContent=fmt(b);$('balNum').className='bal-n '+(b>=0?'pos':'neg');
  $('balLbl').textContent=`Î±Ï€ÏŒ ${fmt(settings.income)} ÎµÎ¹ÏƒÏŒÎ´Î·Î¼Î±`;
  $('wkVal').textContent=fmt(b>0?b/wleft():0);
  $('dyVal').textContent=fmt(b>0?b/dleftN():0);
  $('dLeft').textContent=dleft();
  renderProg();renderTips();
}

function renderProg(){
  const sp=settings.income-fixed()-settings.savings,ts=tSpent();
  const cats=[{k:'super',l:'Î£Î¿ÏÏ€ÎµÏ ÎœÎ¬ÏÎºÎµÏ„',b:settings.supermarket,i:'ğŸ›’'},{k:'food',l:'Î¦Î±Î³Î·Ï„ÏŒ',b:100,i:'ğŸ•'},
  {k:'transport',l:'ÎœÎµÏ„Î±Ï†Î¿ÏÎ¹ÎºÎ¬',b:80,i:'ğŸš—'},{k:'ent',l:'Î¨Ï…Ï‡Î±Î³Ï‰Î³Î¯Î±',b:60,i:'ğŸ¬'},{k:'shop',l:'Î‘Î³Î¿ÏÎ­Ï‚',b:80,i:'ğŸ›ï¸'}];
  let h='';const op=sp>0?Math.min(100,(ts/sp)*100):0;
  const oc=op>90?'var(--red)':op>70?'var(--orange)':'var(--green)';
  h+=`<div class="pr-w"><div class="pr-h"><span class="pr-n">ğŸ’° Î£Ï…Î½Î¿Î»Î¹ÎºÎ¬</span><span class="pr-v">${fmt(ts)} / ${fmt(sp)}</span></div><div class="pr-bar"><div class="pr-fill" style="width:${op}%;background:${oc}"></div></div></div>`;
  cats.forEach(c=>{const s=cSum(c.k);if(!s)return;const p=Math.min(100,(s/c.b)*100);
  const cl=p>100?'var(--red)':p>75?'var(--orange)':'var(--green)';
  h+=`<div class="pr-w"><div class="pr-h"><span class="pr-n">${c.i} ${c.l}</span><span class="pr-v">${fmt(s)} / ${fmt(c.b)}</span></div><div class="pr-bar"><div class="pr-fill" style="width:${p}%;background:${cl}"></div></div></div>`;});
  $('progBars').innerHTML=h;
}

function renderTips(){
  const t=tips();if(!t.length){$('tipBox').innerHTML='';return;}
  $('tipBox').innerHTML=t.map(x=>`<div class="tip"><div class="tip-tag" style="color:${x.color}">ğŸ¤– ${x.tag}</div><div class="tip-ico">${x.icon}</div><div class="tip-txt">${x.txt}</div></div>`).join('');
}

function renderTxL(id,lim){
  const el=$(id);const items=lim>0?transactions.slice(0,lim):transactions;
  if(!items.length){el.innerHTML=`<div class="empty"><div class="empty-i">ğŸ“</div><div class="empty-t">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏƒÏ…Î½Î±Î»Î»Î±Î³Î­Ï‚ Î±ÎºÏŒÎ¼Î±.<br>Î Î¬Ï„Î± Ï„Î¿ + Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚!</div></div>`;return;}
  let h='',last='';
  items.forEach(tx=>{const dl=fDate(tx.date);if(dl!==last){last=dl;h+=`<div class="dsep">${dl}</div>`;}
  const c=CATS[tx.category]||CATS.other;
  h+=`<div class="tx"><div class="tx-ic ${c.css}">${c.icon}</div><div class="tx-d"><div class="tx-n">${esc(tx.description)}</div><div class="tx-m">${c.label} Â· ${fTime(tx.date)}</div></div><div class="tx-a">-${fmt(tx.amount)}</div><button class="tx-x" onclick="delTx('${tx.id}')">âœ•</button></div>`;});
  el.innerHTML=h;
}
</script>
</body>
</html>
